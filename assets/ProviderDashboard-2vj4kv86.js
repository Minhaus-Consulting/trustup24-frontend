import{aa as q,r as a,j as e,B as c,g as o,P as m,a7 as U,N as k,O as P,a1 as A,a9 as f,I as C}from"./index-wr2dCn2t.js";import{T as $}from"./textarea-DkjpQXwy.js";import{B as H}from"./building-Dbe15So8.js";import{P as v}from"./package-DH1bpbYI.js";import{S as y}from"./shopping-bag-BAHFthLW.js";import{P as J}from"./plus-Dt1lk9RK.js";import{S as V}from"./square-pen-IibtHas2.js";import{T as W}from"./trash-2-CzwprXUo.js";function _(){const[,r]=q(),[i,b]=a.useState(null),[p,F]=a.useState([]),[x,B]=a.useState([]),[I,w]=a.useState(!1),[D,h]=a.useState(!1),[l,j]=a.useState(null),[d,n]=a.useState({name:"",description:"",price:"",status:"active"});a.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("user");if(t){const S=JSON.parse(t);S.role==="provider"&&(b(S),w(!0))}const N=await fetch("/api/auth/me",{credentials:"include"});if(!N.ok){localStorage.removeItem("user"),sessionStorage.clear(),r("/login");return}const u=await N.json();if(!u.user||u.user.role!=="provider"){localStorage.removeItem("user"),sessionStorage.clear(),r("/login");return}b(u.user),w(!0),g(),E()}catch(t){console.error("Auth check failed:",t),r("/login")}})()},[r]);const g=async()=>{try{const s=await fetch("/api/provider/products",{credentials:"include"});if(s.ok){const t=await s.json();F(t.products||[])}}catch(s){console.error("Failed to load products:",s)}},E=async()=>{try{const s=await fetch("/api/provider/orders",{credentials:"include"});if(s.ok){const t=await s.json();B(t.orders||[])}}catch(s){console.error("Failed to load orders:",s)}},T=async s=>{s.preventDefault();try{const t=l?`/api/provider/products/${l.id}`:"/api/provider/products";(await fetch(t,{method:l?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...d,price:parseFloat(d.price)})})).ok&&(g(),h(!1),j(null),n({name:"",description:"",price:"",status:"active"}))}catch(t){console.error("Failed to save product:",t)}},z=s=>{j(s),n({name:s.name,description:s.description,price:s.price.toString(),status:s.status}),h(!0)},L=async s=>{if(confirm("Sind Sie sicher, dass Sie dieses Produkt löschen möchten?"))try{(await fetch(`/api/provider/products/${s}`,{method:"DELETE",credentials:"include"})).ok&&g()}catch(t){console.error("Failed to delete product:",t)}},O=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),localStorage.removeItem("user"),sessionStorage.clear(),r("/login")}catch(s){console.error("Logout failed:",s),localStorage.removeItem("user"),sessionStorage.clear(),r("/login")}};return I?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg",children:"Anbieter Dashboard"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Willkommen, ",i==null?void 0:i.name]})]})]}),e.jsx(c,{variant:"outline",onClick:O,children:"Abmelden"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["Willkommen, ",i==null?void 0:i.name,"!"]}),e.jsx("p",{className:"text-gray-600",children:"Verwalten Sie Ihre Produkte und Bestellungen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(o,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Aktive Produkte"}),e.jsx("p",{className:"text-2xl font-bold",children:p.filter(s=>s.status==="active").length})]})]})})}),e.jsx(o,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Bestellungen"}),e.jsx("p",{className:"text-2xl font-bold",children:x.length})]})]})})}),e.jsx(o,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Gesamtumsatz"}),e.jsxs("p",{className:"text-2xl font-bold",children:["€",x.reduce((s,t)=>s+t.totalAmount,0).toFixed(2)]})]})]})})})]}),e.jsxs(o,{className:"mb-8",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Produktverwaltung"]}),e.jsx(A,{children:"Verwalten Sie Ihre Produkte und Services"})]}),e.jsxs(c,{onClick:()=>h(!0),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Produkt hinzufügen"]})]})}),e.jsxs(m,{children:[D&&e.jsxs("form",{onSubmit:T,className:"mb-6 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h3",{className:"font-medium mb-4",children:l?"Produkt bearbeiten":"Neues Produkt hinzufügen"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"name",children:"Produktname"}),e.jsx(C,{id:"name",value:d.name,onChange:s=>n(t=>({...t,name:s.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"price",children:"Preis (€)"}),e.jsx(C,{id:"price",type:"number",step:"0.01",value:d.price,onChange:s=>n(t=>({...t,price:s.target.value})),required:!0})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(f,{htmlFor:"description",children:"Beschreibung"}),e.jsx($,{id:"description",value:d.description,onChange:s=>n(t=>({...t,description:s.target.value})),rows:3})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(c,{type:"submit",children:l?"Aktualisieren":"Hinzufügen"}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>{h(!1),j(null),n({name:"",description:"",price:"",status:"active"})},children:"Abbrechen"})]})]}),p.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Noch keine Produkte vorhanden"})]}):e.jsx("div",{className:"space-y-4",children:p.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("p",{className:"text-lg font-bold mt-1",children:["€",s.price.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.status==="active"?"Aktiv":"Inaktiv"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>z(s),children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>L(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(W,{className:"w-4 h-4"})})]})]})},s.id))})]})]}),e.jsxs(o,{children:[e.jsxs(k,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Eingegangene Bestellungen"]}),e.jsx(A,{children:"Übersicht aller Bestellungen für Ihre Produkte"})]}),e.jsx(m,{children:x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Noch keine Bestellungen eingegangen"})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium",children:["#",s.orderNumber]}),e.jsx("span",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("de-DE")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Kunde"}),e.jsx("p",{className:"font-medium",children:s.customerName}),e.jsx("p",{className:"text-sm text-gray-500",children:s.customerEmail})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Produkt"}),e.jsx("p",{className:"font-medium",children:s.productName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("p",{className:"font-medium",children:s.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Betrag"}),e.jsxs("p",{className:"font-medium",children:["€",s.totalAmount.toFixed(2)]})]})]})]},s.id))})})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Authentifizierung wird überprüft..."})]})})}export{_ as default};
