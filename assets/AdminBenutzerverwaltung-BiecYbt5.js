import{aa as b,r as t,j as e,g as l,P as c,e as A,I as C,N as S,U as g,O as B,a1 as z,Z as L,B as d,f as k,V as I,i as D,S as E}from"./index-48Pj72Q3.js";import{A as U}from"./AdminNavbar-BRSFIyKQ.js";import{E as F}from"./ellipsis-vertical-CTJl5RKN.js";import{C as K}from"./circle-x-FP22CJty.js";import{S as P}from"./square-pen-HsYnCjq5.js";import{T as R}from"./trash-2-BRND3yM5.js";import"./building--oeWMnIm.js";import"./sun-DOAyt5el.js";import"./bell-D-J5xLDD.js";function W(){const[,r]=b(),[j,p]=t.useState([]),[a,f]=t.useState(""),[m,N]=t.useState(!0),[v,o]=t.useState(!1);t.useEffect(()=>{(async()=>{var i;try{const n=localStorage.getItem("user");n&&JSON.parse(n).role==="admin"&&o(!0);const u=await fetch("/api/auth/me",{credentials:"include"});if(!u.ok){localStorage.removeItem("user"),sessionStorage.clear(),r("/login");return}if(((i=(await u.json()).user)==null?void 0:i.role)!=="admin"){localStorage.removeItem("user"),sessionStorage.clear(),r("/login");return}o(!0),y()}catch(n){console.error("Auth check failed:",n),r("/login")}})()},[r]);const y=async()=>{try{const s=await fetch("/api/admin/users",{credentials:"include"});if(s.ok){const i=await s.json();p(i.data||[])}}catch(s){console.error("Failed to fetch users:",s)}finally{N(!1)}},x=j.filter(s=>s.name.toLowerCase().includes(a.toLowerCase())||s.email.toLowerCase().includes(a.toLowerCase())||s.role.toLowerCase().includes(a.toLowerCase())),w=s=>{switch(s){case"admin":return"bg-red-100 text-red-800";case"agency":return"bg-blue-100 text-blue-800";case"client":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},h=s=>new Date(s).toLocaleDateString("de-DE",{year:"numeric",month:"short",day:"numeric"});return v?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(U,{}),e.jsx("div",{className:"pt-16 sm:pt-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Benutzerverwaltung"}),e.jsx("p",{className:"text-gray-600",children:"Verwalten Sie alle Benutzer der Plattform"})]}),e.jsx(l,{className:"mb-6",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(C,{type:"text",placeholder:"Benutzer suchen...",value:a,onChange:s=>f(s.target.value),className:"pl-10"})]})})}),m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Benutzer werden geladen..."})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:x.map(s=>e.jsxs(l,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(S,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-lg",children:s.name}),e.jsxs(z,{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),s.email]})]})]}),e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(F,{className:"w-4 h-4"})})]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:w(s.role),children:s.role==="admin"?"Administrator":s.role==="agency"?"Anbieter":"Kunde"}),e.jsx("div",{className:"flex items-center gap-1",children:s.isActive?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600",children:"Aktiv"})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600",children:"Inaktiv"})]})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsxs("span",{children:["Registriert: ",h(s.createdAt)]})]}),s.lastActiveAt&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-3 h-3"}),e.jsxs("span",{children:["Letzte Aktivität: ",h(s.lastActiveAt)]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(d,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Bearbeiten"]}),e.jsx(d,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(R,{className:"w-3 h-3"})})]})]})]},s.id))}),!m&&x.length===0&&e.jsx(l,{children:e.jsxs(c,{className:"text-center py-12",children:[e.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Keine Benutzer gefunden"}),e.jsx("p",{className:"text-gray-600",children:a?"Keine Benutzer entsprechen Ihrer Suche.":"Es sind noch keine Benutzer registriert."})]})})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Authentifizierung wird überprüft..."})]})})}export{W as default};
