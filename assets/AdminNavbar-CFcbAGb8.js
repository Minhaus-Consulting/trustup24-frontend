import{r as l,j as e,e as x,I as b,B as j,X as k,g as E,P as A,a2 as C,Y as B,f as y,aa as I,aB as L,au as z,av as R,U as w,aw as T,ay as p,ac as U,az as D,af as M}from"./index-wr2dCn2t.js";import{B as F}from"./building-Dbe15So8.js";import{S as $,M as O}from"./sun-BB9LCqXH.js";import{B as P}from"./bell-Bt3n6wl1.js";function Y(){const[d,h]=l.useState(null),[m,t]=l.useState(!0),[r,s]=l.useState(null);return l.useEffect(()=>{let a;const n=async()=>{try{const i=await fetch("/api/admin/stats");if(!i.ok)throw new Error("Failed to fetch stats");const o=await i.json();h(o.data),s(null)}catch(i){s(i instanceof Error?i.message:"Unknown error"),console.error("Error fetching admin stats:",i)}finally{t(!1)}};return n(),a=setInterval(n,6e4),()=>{a&&clearInterval(a)}},[]),{stats:d,loading:m,error:r}}function Z(){const[d,h]=l.useState(null),[m,t]=l.useState(!0);return l.useEffect(()=>{let s;const a=async()=>{try{const n=await fetch("/api/admin/alerts");if(!n.ok)throw new Error("Failed to fetch alerts");const i=await n.json();h(i.data)}catch(n){console.error("Error fetching alerts:",n)}finally{t(!1)}};return a(),s=setInterval(a,3e4),()=>{s&&clearInterval(s)}},[]),{alerts:d,loading:m,markAsRead:async s=>{try{await fetch(`/api/admin/alerts/${s}/read`,{method:"POST"})}catch(a){console.error("Error marking alert as read:",a)}}}}function G(){const[d,h]=l.useState(null),[m,t]=l.useState(!0);return l.useEffect(()=>{let r;const s=async()=>{try{const a=await fetch("/api/admin/system-health");if(!a.ok)throw new Error("Failed to fetch health");const n=await a.json();h(n.data)}catch(a){console.error("Error fetching system health:",a)}finally{t(!1)}};return s(),r=setInterval(s,45e3),()=>{r&&clearInterval(r)}},[]),{health:d,loading:m}}function H(){const[d,h]=l.useState([]),[m,t]=l.useState(!1);return{search:async(s,a)=>{if(!s.trim()){h([]);return}t(!0);try{const n=new URLSearchParams({q:s,limit:"20"});a&&n.append("type",a);const i=await fetch(`/api/admin/search?${n}`);if(!i.ok)throw new Error("Search failed");const o=await i.json();h(o.data||[])}catch(n){console.error("Error searching:",n),h([])}finally{t(!1)}},results:d,loading:m}}function N({onResultSelect:d,placeholder:h="Anbieter, Leads, Benutzer suchen...",className:m=""}){const[t,r]=l.useState(""),[s,a]=l.useState(!1),{search:n,results:i,loading:o}=H();l.useEffect(()=>{const c=setTimeout(()=>{t.trim()?(n(t),a(!0)):a(!1)},300);return()=>clearTimeout(c)},[t,n]);const u=c=>{switch(c){case"user":return e.jsx(B,{className:"w-4 h-4"});case"agency":return e.jsx(F,{className:"w-4 h-4"});case"lead":return e.jsx(C,{className:"w-4 h-4"});default:return e.jsx(x,{className:"w-4 h-4"})}},f=c=>{const g={user:"secondary",agency:"default",lead:"outline"};return e.jsx(y,{variant:g[c]||"default",className:"text-xs",children:c})},v=c=>{r(""),a(!1),d&&d(c)},S=()=>{r(""),a(!1)};return e.jsxs("div",{className:`relative ${m}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(b,{type:"text",placeholder:h,value:t,onChange:c=>r(c.target.value),className:"pl-10 pr-10",onFocus:()=>t&&a(!0)}),t&&e.jsx(j,{variant:"ghost",size:"sm",onClick:S,className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",children:e.jsx(k,{className:"w-4 h-4"})})]}),s&&e.jsx(E,{className:"absolute top-full left-0 right-0 z-50 mt-1 max-h-96 overflow-y-auto",children:e.jsx(A,{className:"p-0",children:o?e.jsxs("div",{className:"p-4 text-center text-gray-600 dark:text-gray-400",children:[e.jsx(x,{className:"w-6 h-6 mx-auto mb-2 animate-spin"}),"Suchen..."]}):i.length>0?e.jsx("div",{className:"max-h-80 overflow-y-auto",children:i.map((c,g)=>e.jsx("div",{onClick:()=>v(c),className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u(c.type),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:c.name||c.companyName||c.email}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:c.email||c.description||"Kein Zusatztext"})]})]}),f(c.type)]})},g))}):t?e.jsxs("div",{className:"p-4 text-center text-gray-600 dark:text-gray-400",children:[e.jsx(x,{className:"w-6 h-6 mx-auto mb-2"}),'Keine Ergebnisse fÃ¼r "',t,'"']}):null})})]})}function J({alertCount:d=0,onSearch:h,darkMode:m=!1,onDarkModeToggle:t}){var i;const[,r]=I();l.useState("");const[s,a]=l.useState(null);l.useEffect(()=>{(async()=>{try{const u=await fetch("/api/auth/me");if(u.ok){const f=await u.json();a(f)}}catch(u){console.error("Failed to load user:",u)}})()},[]);const n=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),r("/login")}catch(o){console.error("Logout failed:",o)}};return e.jsxs("nav",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 fixed top-0 left-0 right-0 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Admin Dashboard"}),e.jsx(y,{variant:"outline",className:"text-xs",children:"Trustup24"})]}),e.jsx("div",{className:"hidden md:flex flex-1 max-w-md mx-8",children:e.jsx(N,{onResultSelect:o=>{o.type==="agency"?r(`/admin/agencies/${o.id}`):o.type==="user"?r(`/admin/users/${o.id}`):o.type==="lead"&&r(`/admin/leads/${o.id}`)}})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsx(L,{checked:m,onCheckedChange:t,className:"data-[state=checked]:bg-blue-600"}),e.jsx(O,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})]}),e.jsxs(j,{variant:"ghost",size:"sm",className:"relative",onClick:()=>r("/admin/alerts"),children:[e.jsx(P,{className:"w-5 h-5"}),d>0&&e.jsx(y,{variant:"destructive",className:"absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center p-0 text-xs",children:d>99?"99+":d})]}),e.jsxs(z,{children:[e.jsx(R,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline text-sm",children:((i=s==null?void 0:s.email)==null?void 0:i.split("@")[0])||"Admin"})]})}),e.jsxs(T,{align:"end",className:"w-48",children:[e.jsxs(p,{onClick:()=>r("/admin/profile"),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Profil"]}),e.jsxs(p,{onClick:()=>r("/admin/settings"),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Einstellungen"]}),e.jsx(D,{}),e.jsxs(p,{onClick:n,className:"text-red-600",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Abmelden"]})]})]})]})]}),e.jsx("div",{className:"md:hidden mt-3",children:e.jsx(N,{placeholder:"Suchen..."})})]})}export{J as A,Z as a,G as b,H as c,Y as u};
