import{aa as O,r as c,j as e,g as N,N as y,O as v,U as F,B as u,a1 as b,P as w,a9 as d,I as o,Z as U,h as C,V as E}from"./index-48Pj72Q3.js";import{C as L}from"./ClientNavbar-DowFR67k.js";import{S as M}from"./square-pen-HsYnCjq5.js";import{P as T}from"./phone-DHq57xBw.js";import{S}from"./shopping-bag-C31sbPxl.js";import{C as J}from"./circle-x-FP22CJty.js";import{P as z}from"./package-Delisi3v.js";import"./bell-D-J5xLDD.js";import"./sun-DOAyt5el.js";function G(){const[,i]=O(),[m,h]=c.useState(null),[p,k]=c.useState([]),[A,g]=c.useState(!1),[t,j]=c.useState(!1),[n,l]=c.useState({name:"",email:"",phone:"",company:"",address:""});c.useEffect(()=>{(async()=>{try{const a=localStorage.getItem("user");if(a){const r=JSON.parse(a);(r.role==="customer"||r.role==="client")&&(h(r),l({name:r.name||"",email:r.email||"",phone:r.phone||"",company:r.company||"",address:r.address||""}),g(!0))}const f=await fetch("/api/auth/me",{credentials:"include"});if(!f.ok){localStorage.removeItem("user"),sessionStorage.clear(),i("/login");return}const x=await f.json();if(!x.user||!["customer","client"].includes(x.user.role)){localStorage.removeItem("user"),sessionStorage.clear(),i("/login");return}h(x.user),g(!0),I()}catch(a){console.error("Auth check failed:",a),i("/login")}})()},[i]);const I=async()=>{try{const s=await fetch("/api/customer/orders",{credentials:"include"});if(s.ok){const a=await s.json();k(a.orders||[])}}catch(s){console.error("Failed to load orders:",s)}},P=async()=>{try{if((await fetch("/api/customer/profile",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)})).ok){j(!1);const a={...m,...n};localStorage.setItem("user",JSON.stringify(a)),h(a)}}catch(s){console.error("Failed to update profile:",s)}},B=s=>{switch(s){case"pending":return e.jsx(C,{className:"w-4 h-4 text-yellow-600"});case"confirmed":return e.jsx(z,{className:"w-4 h-4 text-blue-600"});case"completed":return e.jsx(E,{className:"w-4 h-4 text-green-600"});case"cancelled":return e.jsx(J,{className:"w-4 h-4 text-red-600"});default:return e.jsx(C,{className:"w-4 h-4 text-gray-600"})}},D=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"confirmed":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return A?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(L,{}),e.jsx("div",{className:"pt-16 sm:pt-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Willkommen, ",(m==null?void 0:m.name)||"Kunde","!"]}),e.jsx("p",{className:"text-gray-600",children:"Verwalten Sie Ihr Profil und Ihre Bestellungen"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Mein Profil"]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>j(!t),children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),t?"Abbrechen":"Bearbeiten"]})]}),e.jsx(b,{children:"Ihre persönlichen Daten verwalten"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",value:n.name,onChange:s=>l(a=>({...a,name:s.target.value})),disabled:!t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"E-Mail"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),e.jsx(o,{id:"email",type:"email",value:n.email,onChange:s=>l(a=>({...a,email:s.target.value})),disabled:!t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phone",children:"Telefon"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsx(o,{id:"phone",value:n.phone,onChange:s=>l(a=>({...a,phone:s.target.value})),disabled:!t,placeholder:"Optional"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"company",children:"Unternehmen"}),e.jsx(o,{id:"company",value:n.company,onChange:s=>l(a=>({...a,company:s.target.value})),disabled:!t,placeholder:"Optional"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"address",children:"Adresse"}),e.jsx(o,{id:"address",value:n.address,onChange:s=>l(a=>({...a,address:s.target.value})),disabled:!t,placeholder:"Optional"})]}),t&&e.jsx(u,{onClick:P,className:"w-full",children:"Profil speichern"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Meine Bestellungen"]}),e.jsx(b,{children:"Übersicht aller Ihrer Bestellungen"})]}),e.jsx(w,{children:p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Keine Bestellungen"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Sie haben noch keine Bestellungen getätigt."}),e.jsx(u,{onClick:()=>i("/anbieter-finden"),children:"Anbieter entdecken"})]}):e.jsx("div",{className:"space-y-4",children:p.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["#",s.orderNumber]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${D(s.status)}`,children:[s.status==="pending"&&"Ausstehend",s.status==="confirmed"&&"Bestätigt",s.status==="completed"&&"Abgeschlossen",s.status==="cancelled"&&"Storniert"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[B(s.status),e.jsx("span",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("de-DE")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Produkt"}),e.jsx("p",{className:"font-medium",children:s.productName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Anbieter"}),e.jsx("p",{className:"font-medium",children:s.providerName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Betrag"}),e.jsxs("p",{className:"font-medium",children:["€",s.totalAmount.toFixed(2)]})]})]})]},s.id))})})]})})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Authentifizierung wird überprüft..."})]})})}export{G as default};
