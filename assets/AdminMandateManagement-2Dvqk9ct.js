import{p as H,r as a,J as i,j as e,L as P,z as R,g as c,N as l,O as d,a6 as A,a1 as T,P as o,e as U,I as C,W as $,a9 as G,B as L}from"./index-48Pj72Q3.js";import{S as K,a as O,b as W,c as q,d as J}from"./select-CZxI7kd3.js";import{A as Q}from"./arrow-left-CiEbzfXm.js";import{R as m}from"./refresh-cw-xKOSqyVu.js";import{S as X}from"./save-BUVjkkhT.js";import"./chevron-up-D_xeGbNE.js";function te(){const{toast:n}=H(),[x,E]=a.useState([]),[t,k]=a.useState(""),[h,F]=a.useState(null),[g,j]=a.useState(0),[I,p]=a.useState(!1),[z,f]=a.useState(!1),[N,v]=a.useState(!1),[w,D]=a.useState("");a.useEffect(()=>{S()},[]);const S=async()=>{p(!0);try{const r=await(await i("GET","/api/agencies")).json();E(r)}catch(s){console.error("Error fetching agencies:",s),n({title:"Fehler",description:"Agenturen konnten nicht geladen werden.",variant:"destructive"})}finally{p(!1)}},b=async s=>{f(!0);try{const M=await(await i("GET",`/api/agencies/${s}/mandates`)).json();F(M),j(M.historicalApprovedMandates||0)}catch(r){console.error("Error fetching mandate data:",r),n({title:"Fehler",description:"Mandate konnten nicht geladen werden.",variant:"destructive"})}finally{f(!1)}},B=async()=>{if(t){v(!0);try{await i("PUT",`/api/agencies/${t}/historical-mandates`,{historicalMandates:g}),n({title:"Erfolg",description:"Historische Mandate wurden erfolgreich aktualisiert."}),await b(t)}catch(s){console.error("Error updating mandates:",s),n({title:"Fehler",description:"Fehler beim Aktualisieren der Mandate.",variant:"destructive"})}finally{v(!1)}}},V=async()=>{if(t)try{await i("POST",`/api/agencies/${t}/recalculate-score`),n({title:"Erfolg",description:"Trust Score wurde neu berechnet."}),await S()}catch(s){console.error("Error recalculating trust score:",s),n({title:"Fehler",description:"Fehler beim Neuberechnen des Trust Scores.",variant:"destructive"})}},y=x.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())),u=x.find(s=>s.id===t);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(P,{href:"/admin-bereich",className:"text-muted-foreground hover:text-primary transition-colors",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Mandate Management"})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Mandate verwalten"}),e.jsx("p",{className:"text-muted-foreground",children:"Verwalten Sie die historischen Mandate für alle Agenturen. Diese fließen in die Trust Score Berechnung ein."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Agentur auswählen"]}),e.jsx(T,{children:"Wählen Sie eine Agentur aus, um deren Mandate zu verwalten"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(C,{placeholder:"Agentur suchen...",value:w,onChange:s=>D(s.target.value),className:"pl-9"})]}),e.jsxs(K,{value:t,onValueChange:s=>{k(s),b(s)},children:[e.jsx(O,{children:e.jsx(W,{placeholder:"Agentur auswählen"})}),e.jsx(q,{children:I?e.jsx("div",{className:"text-center py-2",children:e.jsx(m,{className:"h-4 w-4 animate-spin mx-auto"})}):y.length===0?e.jsx("div",{className:"text-center py-2 text-sm text-muted-foreground",children:"Keine Agenturen gefunden"}):y.map(s=>e.jsx(J,{value:s.id,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),s.verified&&e.jsx("span",{className:"text-xs text-green-600 ml-2",children:"✓ Verifiziert"})]})},s.id))})]}),u&&e.jsxs("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Trust Score:"}),e.jsxs("span",{className:"text-sm font-bold text-primary",children:[u.trustedScore||0,"/100"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx("span",{className:"text-sm",children:u.verified?e.jsx("span",{className:"text-green-600",children:"✓ Verifiziert"}):e.jsx("span",{className:"text-yellow-600",children:"Ausstehend"})})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Mandate Management"]}),e.jsx(T,{children:"Verwalten Sie die historischen und aktuellen Mandate"})]}),e.jsx(o,{children:t?z?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(m,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{className:"text-muted-foreground",children:"Lade Mandate..."})]}):h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(c,{className:"border",children:[e.jsx(l,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Total Mandate"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold",children:h.totalMandates}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Historisch + Plattform-Buchungen"})]})]}),e.jsxs(c,{className:"border",children:[e.jsx(l,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Letzte Aktualisierung"})}),e.jsx(o,{children:e.jsx("div",{className:"text-lg",children:new Date(h.lastUpdated).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"historical-mandates",children:"Historische genehmigte Mandate"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{id:"historical-mandates",type:"number",min:"0",value:g,onChange:s=>j(parseInt(s.target.value)||0),className:"max-w-[200px]"}),e.jsx(L,{onClick:B,disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Speichern"]})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Anzahl der erfolgreich abgeschlossenen Mandate vor der Plattform-Nutzung"})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Trust Score Impact"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Mandate fließen in die "Substanz & Erfahrung"-Kategorie (20%) des Trust Scores ein. Nach dem Speichern können Sie den Trust Score neu berechnen.'}),e.jsxs(L,{variant:"outline",onClick:V,className:"w-full",children:[e.jsx(m,{className:"mr-2 h-4 w-4"}),"Trust Score neu berechnen"]})]})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Fehler beim Laden der Mandate. Bitte versuchen Sie es erneut."})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Bitte wählen Sie eine Agentur aus, um deren Mandate zu verwalten."})]})})]})})]})]})}export{te as default};
