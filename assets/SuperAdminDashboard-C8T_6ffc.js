import{aa as U,r as n,j as e,g as l,P as i,Y as j,aC as T,Z as h,N as p,O as f,a1 as g,e as I,I as M,f as N,B as v}from"./index-48Pj72Q3.js";import{A as P}from"./AdminNavbar-BRSFIyKQ.js";import{B as F}from"./building--oeWMnIm.js";import{S as K}from"./send-Cz9C9Dc8.js";import{T as O}from"./trash-2-BRND3yM5.js";import"./sun-DOAyt5el.js";import"./bell-D-J5xLDD.js";function W(){const[,c]=U(),[y,w]=n.useState([]),[m,b]=n.useState([]),[d,S]=n.useState(""),[C,u]=n.useState(!1),[x,E]=n.useState({});n.useEffect(()=>{(async()=>{try{const a=localStorage.getItem("user");if(a){const R=JSON.parse(a);["admin","platform_admin"].includes(R.role)&&u(!0)}const t=await fetch("/api/auth/me",{credentials:"include"});if(!t.ok){localStorage.removeItem("user"),sessionStorage.clear(),c("/login");return}const r=await t.json();if(!r.user||!["admin","platform_admin"].includes(r.user.role)){localStorage.removeItem("user"),sessionStorage.clear(),c("/login");return}u(!0),o()}catch(a){console.error("Auth check failed:",a),c("/login")}})()},[c]);const o=async()=>{try{const s=await fetch("/api/admin/all-users",{credentials:"include"});if(s.ok){const r=await s.json();w(r.users||[])}const a=await fetch("/api/admin/email-drafts",{credentials:"include"});if(a.ok){const r=await a.json();b(r.drafts||[])}const t=await fetch("/api/admin/platform-stats",{credentials:"include"});if(t.ok){const r=await t.json();E(r.stats||{})}}catch(s){console.error("Failed to load data:",s)}},A=async(s,a)=>{try{(await fetch(`/api/admin/users/${s}/role`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({role:a})})).ok&&o()}catch(t){console.error("Failed to update user role:",t)}},D=async s=>{try{(await fetch(`/api/admin/email-drafts/${s}/send`,{method:"POST",credentials:"include"})).ok&&o()}catch(a){console.error("Failed to send email:",a)}},k=async s=>{if(confirm("E-Mail-Entwurf löschen?"))try{(await fetch(`/api/admin/email-drafts/${s}`,{method:"DELETE",credentials:"include"})).ok&&o()}catch(a){console.error("Failed to delete email draft:",a)}},B=y.filter(s=>s.name.toLowerCase().includes(d.toLowerCase())||s.email.toLowerCase().includes(d.toLowerCase())||s.role.toLowerCase().includes(d.toLowerCase())),L=s=>{switch(s){case"admin":case"platform_admin":return"bg-red-100 text-red-800";case"provider":return"bg-blue-100 text-blue-800";case"customer":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},z=s=>{switch(s){case"admin":case"platform_admin":return"Administrator";case"provider":return"Anbieter";case"customer":return"Kunde";default:return s}};return C?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(P,{}),e.jsx("div",{className:"pt-16 sm:pt-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Super Admin Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Umfassende Plattform-Verwaltung"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Alle Benutzer"}),e.jsx("p",{className:"text-2xl font-bold",children:x.totalUsers||0})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Anbieter"}),e.jsx("p",{className:"text-2xl font-bold",children:x.totalProviders||0})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Kunden"}),e.jsx("p",{className:"text-2xl font-bold",children:x.totalCustomers||0})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(h,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"E-Mail Entwürfe"}),e.jsx("p",{className:"text-2xl font-bold",children:m.length})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(l,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),"Benutzerverwaltung"]}),e.jsx(g,{children:"Alle Benutzer verwalten und Rollen zuweisen"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(M,{placeholder:"Benutzer suchen...",value:d,onChange:s=>S(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:B.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email})]}),e.jsx(N,{className:L(s.role),children:z(s.role)})]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsxs("select",{value:s.role,onChange:a=>A(s.id,a.target.value),className:"text-sm border rounded px-2 py-1",children:[e.jsx("option",{value:"customer",children:"Kunde"}),e.jsx("option",{value:"provider",children:"Anbieter"}),e.jsx("option",{value:"admin",children:"Administrator"})]})})]},s.id))})]})]}),e.jsxs(l,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5"}),"E-Mail-Entwürfe"]}),e.jsx(g,{children:"Willkommens-E-Mails prüfen und versenden"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Keine E-Mail-Entwürfe vorhanden"})]}):m.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.subject}),e.jsxs("p",{className:"text-sm text-gray-600",children:["An: ",s.recipientEmail]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Erstellt: ",new Date(s.createdAt).toLocaleDateString("de-DE")]})]}),e.jsx(N,{variant:s.status==="draft"?"secondary":"default",children:s.status==="draft"?"Entwurf":"Gesendet"})]}),e.jsx("div",{className:"bg-gray-50 rounded p-3 mb-3",children:e.jsxs("p",{className:"text-sm",children:[s.body.substring(0,150),"..."]})}),s.status==="draft"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{size:"sm",onClick:()=>D(s.id),className:"flex-1",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Senden"]}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>k(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(O,{className:"w-3 h-3"})})]})]},s.id))})})]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Authentifizierung wird überprüft..."})]})})}export{W as default};
